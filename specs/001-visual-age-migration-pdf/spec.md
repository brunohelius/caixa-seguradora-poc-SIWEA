# Feature Specification: Comprehensive Visual Age Migration Analysis & Planning Document

**Feature Branch**: `001-visual-age-migration-pdf`
**Created**: 2025-10-23
**Status**: Draft
**Input**: User description: "crie um documento PDF com toda a analise do sistema legado visual agel, de forma extensiva. Nesse mesmo documento, coloque todo o plano de migracao para .net com react , componentes, paginas, funcionaliades com todos os descritivos de como isso deve funcionar, coloque quantos pontos de funcao o projeto de migrqcao e crie um cronograma de migracao com um prazo de 2 meses, com a metodologia de desenvolvimeno migrai, com framework de migracao com llms e etc. Entao serao 2 meses de projeto com 1 mes de homologacao, organize dessa forma, iremos cobrar por ponto de funcao o valor de 750 reais a hora, valor fechado. Entao prepare esse PDF de forma bem organizada com o maximo de inforamcao possiuvel"

## User Scenarios & Testing

### User Story 1 - Generate Comprehensive Migration Analysis Document (Priority: P1)

Project managers and technical stakeholders need a comprehensive PDF document that provides extensive analysis of the legacy IBM VisualAge EZEE Claims System (SIWEA), complete migration planning to .NET 9 with React, detailed function point analysis, MIGRAI methodology implementation, and a realistic 3-month timeline (2 months development + 1 month homologation) with budget calculation.

**Why this priority**: This document serves as the foundation for project approval, stakeholder alignment, budget authorization, and technical execution. Without this comprehensive documentation, the migration project cannot proceed with proper planning and risk mitigation.

**Independent Test**: Can be fully tested by generating the PDF document and validating that all required sections are present with minimum content thresholds: executive summary (2-3 pages), legacy system analysis (minimum 15 pages), migration architecture plan (minimum 20 pages), function point calculation with detailed breakdown, MIGRAI methodology description with LLM framework integration, complete 2-month Gantt chart with milestones, and accurate budget calculation based on function points at R$ 750 per point.

**Acceptance Scenarios**:

1. **Given** project initiation requirements, **When** the document is generated, **Then** it contains a comprehensive executive summary (2-3 pages) with project overview, business justification, high-level architecture, timeline, budget, and expected ROI
2. **Given** the need for legacy system understanding, **When** viewing the document, **Then** it includes extensive Visual Age SIWEA analysis covering: system architecture, 42 business rules with detailed descriptions, database schema (13 entities with ER diagrams), CICS transaction flows, ESQL code analysis, integration points (CNOUA/SIPUA/SIMDA), current performance metrics, technical debt assessment, and migration risks
3. **Given** architecture planning requirements, **When** the document describes the target .NET 9 + React solution, **Then** it provides: Clean Architecture pattern with layer diagrams, technology stack justification (ASP.NET Core 9, React 19, EF Core 9, SoapCore), component breakdown (controllers, services, repositories, React components), page-level design specifications (ClaimSearch, ClaimDetail, MigrationDashboard), API contract designs (REST + SOAP endpoints), database migration strategy, and deployment architecture (Docker, Azure)
4. **Given** the need for effort estimation, **When** the document presents function point analysis, **Then** it includes: detailed FPA calculation using IFPUG 4.3.1 method, breakdown by component type (EI, EO, EQ, ILF, EIF), complexity ratings (Low/Average/High), unadjusted function points, general system characteristics assessment (14 factors), value adjustment factor calculation, and final adjusted function points with estimated total of 180-220 AFP
5. **Given** budget planning requirements, **When** the document calculates project cost, **Then** it shows: total function points multiplied by R$ 750 per FP, additional costs (infrastructure, testing, training, contingency), total project investment estimate of R$ 180,000-220,000, and payment milestones aligned with timeline phases
6. **Given** the need for a detailed schedule, **When** the document presents the 3-month timeline, **Then** it includes: Week-by-week Gantt chart spanning 8 weeks development + 4 weeks homologation, phase breakdown (Phase 0: Research, Phase 1: Foundation, Phase 2: Core Features, Phase 3: Integration & Testing, Phase 4: Homologation), sprint structure with ceremonies, key milestones with dates and deliverables, and critical path identification
7. **Given** methodology adoption requirements, **When** the document describes MIGRAI methodology, **Then** it explains the six principles (Modernization, Intelligence, Gradual migration, Resilience, Automation, Integration), LLM framework integration for code generation and validation using Claude Code, AI-assisted documentation generation, automated function point calculation, and continuous integration with AI-powered quality gates
8. **Given** the need for implementation guidance, **When** the document describes each migration component, **Then** it provides: React component specifications with props/state/hooks/styling using Site.css, backend service interfaces with method signatures, business rule migration mapping from Visual Age ESQL to C# with examples, database entity configurations using EF Core Fluent API, external service integration patterns with Polly retry policies, and testing strategies (unit, integration, E2E, parity tests)
9. **Given** risk management requirements, **When** the document addresses project risks, **Then** it identifies: high-risk areas (external service dependencies, currency conversion logic, concurrent user handling), mitigation strategies with specific actions, contingency plans with fallback approaches, and success criteria for go-live decision
10. **Given** stakeholder review needs, **When** the document is formatted as PDF, **Then** it follows professional standards: branded header/footer with Caixa Seguradora logo, table of contents with page numbers, consistent typography (headings, body text, code blocks), high-quality diagrams (architecture, ER diagrams, sequence diagrams, Gantt charts), color-coded sections for readability, and appendices with technical references

---

### Edge Cases

- What happens if function point calculation yields significantly different estimates than initial budget expectations?
- How does the document handle incomplete information about Visual Age system internals when source code is partially documented?
- What if external service contracts (CNOUA/SIPUA/SIMDA) are undocumented or unavailable during analysis?
- How does the timeline account for unexpected technical discoveries during legacy code analysis?
- What if the 2-month development timeline proves insufficient based on complexity discovered during Phase 0 research?
- How does the budget handle scope creep or additional feature requests discovered during migration?
- What if the development team is unfamiliar with MIGRAI methodology and requires additional training time?
- How does the document address regulatory compliance requirements (SUSEP, LGPD) not explicitly mentioned in legacy system?

## Requirements

### Functional Requirements

#### Document Structure and Content
- **FR-001**: Document MUST contain a comprehensive executive summary (2-3 pages) covering project overview, business justification, migration approach, timeline, budget, ROI projection, and executive decision points
- **FR-002**: Document MUST include detailed Visual Age SIWEA legacy system analysis spanning minimum 15 pages covering system architecture, business rules, database schema, transaction flows, integration points, performance metrics, and technical debt
- **FR-003**: Document MUST provide complete .NET 9 + React 19 target architecture specification spanning minimum 20 pages including Clean Architecture pattern, technology stack, component designs, page specifications, API contracts, and deployment strategy
- **FR-004**: Document MUST include detailed function point analysis using IFPUG 4.3.1 methodology with component breakdown (EI, EO, EQ, ILF, EIF), complexity ratings, unadjusted FP, adjustment factors (14 GSC factors), and final adjusted FP total estimated between 180-220 AFP
- **FR-005**: Document MUST present complete 3-month project timeline with week-by-week Gantt chart spanning 8 weeks development + 4 weeks homologation, sprint structure, milestones, deliverables, critical path, and resource allocation
- **FR-006**: Document MUST describe MIGRAI methodology implementation including six principles (Modernization, Intelligence, Gradual migration, Resilience, Automation, Integration), LLM framework integration with Claude Code, AI-assisted code generation, automated testing, and continuous integration

#### Legacy System Analysis
- **FR-007**: Document MUST analyze all 42 business rules from Visual Age SIWEA system with detailed descriptions, ESQL code samples, input/output specifications, and migration complexity assessment for each rule
- **FR-008**: Document MUST include Entity-Relationship diagrams for all 13 legacy database tables (TMESTSIN, THISTSIN, TGERAMO, TGEUNIMO, TSISTEMA, TAPOLICE, SI_ACOMPANHA_SINI, SI_SINISTRO_FASE, SI_REL_FASE_EVENTO, EF_CONTR_SEG_HABIT) with column definitions, data types, relationships, primary/foreign keys, and constraints
- **FR-009**: Document MUST document CICS transaction flows for claim search, payment authorization, and history retrieval with sequence diagrams showing CICS maps (SIWEG, SIWEGH), program calls, and data flow between components
- **FR-010**: Document MUST analyze external service integrations (CNOUA for consortium validation, SIPUA for EFP contracts, SIMDA for HB contracts) including protocols (SOAP/HTTP), error codes, response structures, and performance characteristics
- **FR-011**: Document MUST provide current system performance baseline including average response times (search, authorization, queries), peak concurrent users, transaction throughput (TPS), database query performance, and system availability metrics (uptime percentage)

#### Target Architecture Specification
- **FR-012**: Document MUST include Clean Architecture layer diagrams showing separation between API, Core (domain), and Infrastructure layers with dependency direction arrows, component placement, and interface boundaries
- **FR-013**: Document MUST specify all React 19 components with TypeScript interfaces including ClaimSearchForm, ClaimDetailView, PaymentAuthorizationForm, HistoryTable, DashboardCards, and shared UI components with props, state, and hooks documentation
- **FR-014**: Document MUST define all backend service interfaces (IClaimService, IPaymentService, IValidationService, ICurrencyConversionService, IPhaseManagementService) with method signatures, DTOs (Data Transfer Objects), and exception handling patterns
- **FR-015**: Document MUST document all REST API endpoints (GET/POST /api/claims, /api/payments, /api/history, /api/dashboard) with OpenAPI 3.0 specifications including request/response schemas, HTTP status codes, authentication requirements, and error formats
- **FR-016**: Document MUST document all SOAP endpoints (/soap/autenticacao, /soap/solicitacao, /soap/assunto) with WSDL generation approach using SoapCore, namespace mappings matching Visual Age contracts, and fault handling
- **FR-017**: Document MUST specify EF Core 9 entity configurations for all 13 legacy tables using Fluent API with legacy column name mappings, decimal precision for currency fields (decimal(15,2)), relationship definitions, and concurrency token handling
- **FR-018**: Document MUST describe external service integration patterns using HttpClient factory pattern, Polly resilience policies (retry with exponential backoff, circuit breaker), timeout handling (5-30 seconds depending on service), and fallback strategies
- **FR-019**: Document MUST define authentication and authorization strategy including JWT token generation, Active Directory integration for EZEUSRID mapping to modern user principals, role-based access control (if applicable), and session management approach

#### Component and Page Specifications
- **FR-020**: Document MUST provide detailed ClaimSearchPage React component specification including search form fields (protocol number with 3 parts, claim number with 3 parts, leader code + leader claim number), validation rules (at least one complete criterion required), API integration with Axios, loading states, error display using Site.css error styling (#e80c4d), and results table presentation
- **FR-021**: Document MUST provide detailed ClaimDetailPage React component specification including claim summary display (protocol, policy, insured name, reserve, payments, pending), payment authorization form (payment type dropdown 1-5, principal amount numeric input, correction value optional numeric, beneficiary conditional text field), validation logic (beneficiary required when tpsegu != 0), SOAP/REST API integration, transaction status tracking, and success/error messaging in Portuguese
- **FR-022**: Document MUST provide detailed MigrationDashboardPage React component specification including progress overview cards (percentage complete with visual progress bar), user story status grid (6 stories with color-coded status indicators), component migration tracking (screens/business rules/entities/services breakdown), performance comparison charts (Visual Age vs .NET metrics using Recharts library), recent activities timeline (last 10 completed tasks), and system health indicators (API availability, database connectivity, external service status)
- **FR-023**: Document MUST specify styling approach using Site.css preservation strategy including CSS class mapping from legacy CICS screen layouts to React components, responsive design breakpoints (max-width: 960px for desktop content wrapper, 850px for mobile), color scheme matching Visual Age (#e80c4d for validation errors, standard text colors), font specifications, and Caixa Seguradora logo rendering from base64 PNG in header
- **FR-024**: Document MUST define all TypeScript interfaces and types for domain models including Claim, ClaimHistory, PaymentAuthorization, Branch, CurrencyRate, ClaimPhase, MigrationStatus, ComponentTracking, and PerformanceMetric with property types, optional vs required fields, and validation constraints

#### Function Point Analysis
- **FR-025**: Document MUST calculate External Inputs (EI) function points for user-initiated transactions: claim search form (EI complexity based on search fields and validation), payment authorization form (EI complexity based on payment fields and business rules), phase management operations, with complexity classification (Low: 1-4 DETs & 0-1 FTRs = 3 FP, Average: 5-15 DETs & 2 FTRs = 4 FP, High: 16+ DETs & 3+ FTRs = 6 FP)
- **FR-026**: Document MUST calculate External Outputs (EO) function points for derived data presentations: claim detail report with calculations, payment authorization confirmation with derived totals, history report with aggregations, dashboard overview with computed metrics, with complexity classification based on output DETs and processing logic
- **FR-027**: Document MUST calculate External Inquiries (EQ) function points for simple retrieval operations: claim lookup by protocol/number/leader (input DETs + output DETs), payment history retrieval, phase status query, dashboard metrics query, with complexity based on input/output DET count and FTR (File Types Referenced) analysis
- **FR-028**: Document MUST calculate Internal Logical Files (ILF) function points for application-maintained data: ClaimMaster (complexity based on RETs and DETs), ClaimHistory, ClaimPhase, MigrationStatus tables, with complexity classification (Low: 1 RET & 1-19 DETs or 2-5 RETs & 1-19 DETs = 7 FP, Average: 1 RET & 20-50 DETs or 2-5 RETs & 20-50 DETs = 10 FP, High: 1 RET & 51+ DETs or 2-5 RETs & 51+ DETs or 6+ RETs = 15 FP)
- **FR-029**: Document MUST calculate External Interface Files (EIF) function points for referenced external data: CNOUA service interface, SIPUA service interface, SIMDA service interface, currency rate table (TGEUNIMO), system control table (TSISTEMA), branch master (TGERAMO), with complexity assessment based on RETs and DETs
- **FR-030**: Document MUST calculate Value Adjustment Factor (VAF) based on 14 General System Characteristics with degree of influence (0-5) for each: data communications (5 - distributed web system), distributed data processing (4 - client/server), performance (5 - response time critical), heavily used configuration (4 - concurrent users), transaction rate (4 - moderate volume), online data entry (5 - primary interaction mode), end-user efficiency (4 - responsive UI), online update (5 - real-time updates), complex processing (5 - business rules and calculations), reusability (4 - service-oriented), installation ease (3 - Docker deployment), operational ease (4 - monitoring and logging), multiple sites (2 - single cloud deployment), facilitate change (5 - modern maintainable architecture)
- **FR-031**: Document MUST present final adjusted function points calculation using formula: AFP = UFP × VAF, where UFP = sum of all EI/EO/EQ/ILF/EIF function points and VAF = 0.65 + (0.01 × sum of all 14 GSC degree of influence values), resulting in estimated total of 180-220 AFP

#### Timeline and Scheduling
- **FR-032**: Document MUST define Phase 0 - Research & Technical Decisions (Week 1, 5 business days) including tasks: database access strategy research (EF Core provider selection), SOAP implementation approach (SoapCore evaluation), external service integration planning (Polly policies), authentication mechanism design (JWT + AD), performance benchmarking strategy, deliverable: research.md document with architecture decisions
- **FR-033**: Document MUST define Phase 1 - Foundation & Infrastructure (Weeks 2-3, 10 business days) including tasks: project scaffolding (backend .NET solution with API/Core/Infrastructure layers, frontend React app with Vite), NuGet package installation (EF Core, SoapCore, AutoMapper, Serilog, Polly), npm package installation (React, React Router, Axios, Recharts), EF Core DbContext with 13 entity configurations using Fluent API, repository pattern implementation, deliverables: compilable backend solution, runnable frontend skeleton with routing, data-model.md with entity specifications, contracts/ directory with OpenAPI and WSDL specs
- **FR-034**: Document MUST define Phase 2 - Core Business Logic Implementation (Weeks 4-5, 10 business days) including tasks: ClaimService implementation (search by protocol/claim/leader), PaymentService implementation with validation and history creation, CurrencyConversionService with BTNF calculation logic, PhaseManagementService with workflow state transitions, migration of 42 business rules from Visual Age ESQL to C# methods, unit test implementation for all services achieving 80%+ code coverage, deliverables: passing unit test suite, core-services.md documentation, business-rules-migration-map.md showing ESQL to C# mappings
- **FR-035**: Document MUST define Phase 3 - API Layer & External Integrations (Week 6, 5 business days) including tasks: REST controllers implementation (ClaimsController, PaymentsController, DashboardController) with DTOs, AutoMapper profiles for entity-to-DTO mappings, SOAP service implementations (AutenticacaoService, SolicitacaoService, AssuntoService) with SoapCore configuration, external service client implementations (CNOUA/SIPUA/SIMDA HTTP clients with Polly retry and circuit breaker), authentication middleware with JWT validation, deliverables: functional Swagger UI with all endpoints documented, SOAP WSDL accessible at /soap endpoints, passing API integration tests, external-integrations.md with service contract documentation
- **FR-036**: Document MUST define Phase 4 - Frontend Development (Week 7, 5 business days) including tasks: ClaimSearchPage implementation with search form and results table, ClaimDetailPage implementation with payment authorization form and validation, MigrationDashboardPage implementation with progress cards and charts using Recharts, Site.css integration and responsive layout verification, Caixa Seguradora logo rendering in header from base64 PNG, TypeScript interface definitions for all API models, Axios API client services with error handling, deliverables: functional UI for all 6 user stories, passing React component tests using React Testing Library, frontend-components.md documentation
- **FR-037**: Document MUST define Phase 5 - Testing & Quality Assurance (Week 8, 5 business days) including tasks: E2E test implementation using Playwright or Cypress for critical user journeys (search claim → authorize payment → view history), parity testing comparing Visual Age outputs with .NET outputs for same inputs, performance benchmarking (claim search < 3s, authorization cycle < 90s), load testing with JMeter or k6 (1000 concurrent users), security testing (OWASP top 10 checks), deliverables: E2E test suite with 95%+ pass rate, parity-test-results.md showing functional equivalence, performance-benchmarks.md with comparison metrics, security-scan-report.md
- **FR-038**: Document MUST define Phase 6 - Homologation Period (Weeks 9-12, 20 business days) including tasks: production-like environment deployment to Azure (App Service + SQL Database), user acceptance testing with insurance operators (10-15 users), parallel operation with Visual Age system for validation, defect triage and fixing (priority-based), performance tuning based on real usage patterns, documentation finalization (user guides, operational runbooks), go-live readiness assessment (checklist review), deliverables: signed UAT acceptance document, deployment-runbook.md with step-by-step instructions, rollback-procedure.md for emergency fallback, go-live-checklist.md with approval signatures

#### MIGRAI Methodology
- **FR-039**: Document MUST explain MIGRAI principle "Modernization" - migrating to modern tech stack (.NET 9 framework with C# 12 language features, React 19 with concurrent rendering, Docker containerization) while preserving 100% of business logic, leveraging cloud-native patterns (stateless services, horizontal scaling, managed databases), improving code maintainability through Clean Architecture separation of concerns, and reducing technical debt from legacy COBOL/CICS/ESQL
- **FR-040**: Document MUST explain MIGRAI principle "Intelligence" - using Large Language Models (Claude 3.5 Sonnet via Anthropic API) for automated code generation from Visual Age ESQL to C# with 95%+ accuracy, AI-assisted test generation from business rule specifications, automated documentation extraction from legacy code comments, code review automation checking Clean Architecture compliance, and knowledge extraction from undocumented legacy systems
- **FR-041**: Document MUST explain MIGRAI principle "Gradual migration" - phased rollout strategy following user story priority order (P1: Search → P2: Authorization → P3: History → P4: Consortium → P5: Workflow → P6: Dashboard), feature toggles for controlled activation per user group, parallel operation period (minimum 2 weeks) with Visual Age system for validation, incremental data migration with fallback to legacy, and rollback procedures available at each phase gate
- **FR-042**: Document MUST explain MIGRAI principle "Resilience" - implementing Polly retry policies with exponential backoff (initial 1s, max 30s, 3 retries) for transient failures, circuit breaker patterns for external services (open circuit after 5 consecutive failures, half-open after 60s), fallback mechanisms using cached data when services unavailable, comprehensive exception handling with user-friendly Portuguese error messages, graceful degradation (disable non-critical features if dependencies fail), and transaction rollback capability for data integrity
- **FR-043**: Document MUST explain MIGRAI principle "Automation" - GitHub Actions CI/CD pipeline with automated build/test/deploy stages, automated unit testing with xUnit (target 80%+ coverage), automated integration testing with TestServer, automated E2E testing with Playwright, automated deployment to Azure environments (dev/staging/prod), automated function point tracking from user stories and requirements changes, automated security scanning with OWASP dependency check, and automated performance regression detection comparing baseline metrics
- **FR-044**: Document MUST explain MIGRAI principle "Integration" - maintaining existing SOAP integration contracts for legacy client systems (namespace preservation, WSDL compatibility), providing new RESTful APIs following OpenAPI 3.0 specification for modern clients, database schema compatibility with zero changes to existing tables (EF Core Fluent API for mapping), seamless authentication integration with enterprise Active Directory using LDAP/SAML, preservation of external service contracts (CNOUA/SIPUA/SIMDA), and backward-compatible error codes/messages
- **FR-045**: Document MUST describe LLM framework integration including Claude Code usage for pair programming during ESQL-to-C# migration, automated code translation with validation against business rule specifications, automated test generation from Given-When-Then acceptance scenarios, OpenAPI specification generation from C# controller interfaces and data models, automated documentation generation from XML code comments and markdown templates, and automated function point calculation from user story descriptions using IFPUG guidelines
- **FR-046**: Document MUST describe AI-assisted quality gates including automated code review checking for Clean Architecture violations (dependencies pointing outward, Core layer framework-agnostic), automated function point recalculation when requirements change (triggering budget review), automated test coverage analysis with gap identification (uncovered branches and edge cases), automated performance regression detection comparing current metrics to baseline (alert if response time increases > 20%), and automated security vulnerability scanning using OWASP ZAP and SonarQube

#### Budget and Cost Estimation
- **FR-047**: Document MUST present budget calculation formula: Total Project Cost = (Adjusted Function Points × R$ 750 per FP) + Infrastructure Costs + Additional Costs + Contingency Reserve (15% of subtotal)
- **FR-048**: Document MUST break down infrastructure costs including Azure App Service Premium P1v3 tier for production (2 instances for high availability = R$ 2,500/month × 3 months = R$ 7,500), Azure SQL Database S3 tier with 100 GB storage (R$ 1,200/month × 3 months = R$ 3,600), Azure Key Vault for secrets management (R$ 500/month × 3 months = R$ 1,500), Azure Application Insights for monitoring and diagnostics (R$ 500/month × 3 months = R$ 1,500), development and staging environments (R$ 2,000 one-time), total infrastructure = R$ 16,100
- **FR-049**: Document MUST define payment milestones aligned with timeline phases: Milestone 1 at contract signature (20% = upfront commitment), Milestone 2 after Phase 1 completion with foundation deliverables verified (20%), Milestone 3 after Phase 5 completion with all testing passed (30% = largest payment for major deliverable), Milestone 4 after UAT approval with homologation complete (20%), Milestone 5 at 30 days post-go-live with production stability confirmed (10% = retention for warranty period)
- **FR-050**: Document MUST include ROI projection showing annual cost savings from: reduced mainframe MIPS consumption and IBM DB2 licensing (estimated R$ 30,000/year), improved developer productivity using modern tools vs CICS/ESQL (20% efficiency gain = R$ 40,000/year), faster time-to-market for new features (reduced development cycle from 6 months to 2 months), reduced training costs for new developers (modern .NET/React vs mainframe skills = R$ 15,000/year), improved system availability with cloud hosting (99.9% SLA vs current 95% = R$ 10,000/year revenue protection), total annual savings = R$ 95,000, resulting in payback period of 2.1 years

#### Diagrams and Visual Elements
- **FR-051**: Document MUST include High-Level Architecture Diagram showing six tiers: client tier (web browsers desktop/mobile, legacy SOAP clients), presentation tier (React SPA with Site.css styling), API tier (ASP.NET Core 9 with REST controllers and SOAP services via SoapCore), business logic tier (Core services implementing domain logic), data access tier (EF Core repositories with Fluent API configurations), external services tier (CNOUA/SIPUA/SIMDA HTTP clients with Polly resilience), and database tier (Azure SQL Database or IBM DB2 with 13 legacy tables), with arrows showing request/response flow and technology labels
- **FR-052**: Document MUST include Clean Architecture Onion Diagram showing four concentric circles with dependencies pointing inward: Core at center (entities: Claim/ClaimHistory/etc, interfaces: IClaimRepository/IPaymentService, business rules in pure C#), Application layer (service implementations, validators using FluentValidation, DTOs for data transfer), Infrastructure layer (EF Core DbContext and repositories, HttpClient for external services, Serilog for logging), API layer (controllers, SOAP services, middleware for auth/error handling), with dependency injection arrows showing outer layers depending on inner abstractions
- **FR-053**: Document MUST include Entity-Relationship Diagram for legacy schema showing all 13 tables (TMESTSIN, THISTSIN, TGERAMO, TGEUNIMO, TSISTEMA, TAPOLICE, SI_ACOMPANHA_SINI, SI_SINISTRO_FASE, SI_REL_FASE_EVENTO, EF_CONTR_SEG_HABIT, MigrationStatus, ComponentMigrationTracking, PerformanceMetrics) with primary keys in bold, foreign keys with relationship arrows, cardinality notations (1:1, 1:N, N:M), and critical columns highlighted (protocol numbers, claim numbers, currency amounts with decimal(15,2), dates, status codes)
- **FR-054**: Document MUST include Component Diagram for React frontend showing hierarchical structure: App.tsx root component, routing with React Router (routes: /, /claims/:id, /dashboard), pages layer (ClaimSearchPage, ClaimDetailPage, MigrationDashboardPage), components layer (ClaimSearchForm, PaymentAuthorizationForm, HistoryTable, DashboardCard, ProgressBar, StatusIndicator), services layer (claimsApi.ts, paymentsApi.ts, dashboardApi.ts, httpClient.ts with Axios config), models layer (TypeScript interfaces), utils layer (formatters.ts for currency/date, validators.ts for form validation), with import dependencies shown as arrows
- **FR-055**: Document MUST include Sequence Diagram for payment authorization flow showing 10 participants in order: Operator (actor), React PaymentAuthorizationForm component, ClaimsController (API), ClaimService (Core), ValidationService (Core), CNOUA/SIPUA/SIMDA External Service, PaymentService (Core), ClaimRepository (Infrastructure), EF Core DbContext, Database, with message flow: form submit → API call → service orchestration → external validation (with retry on failure) → payment creation → history record → phase update → database transaction commit (or rollback on error) → response propagation back to UI, and error handling branches shown as alt fragments
- **FR-056**: Document MUST include Gantt Chart for 3-month timeline showing: 6 phases as horizontal swimlanes (Phase 0-5 covering weeks 1-8, Phase 6 covering weeks 9-12), tasks within each phase as colored bars with start/end dates, dependencies between tasks shown as arrows (e.g., API Layer depends on Core Services completion), milestones shown as diamond symbols with dates (M1: Research complete, M2: Foundation ready, M3: Core services done, M4: APIs functional, M5: UI complete, M6: Testing passed, M7: UAT approved, M8: Go-live), critical path highlighted in red color, and resource allocation swimlanes at bottom showing team member assignments (2 backend devs, 2 frontend devs, 1 QA, 1 DevOps, 1 tech lead, 1 PM)

#### Document Formatting and Presentation
- **FR-057**: Document MUST use professional formatting with branded header on every page including Caixa Seguradora logo (rendered from base64 PNG in top-left), document title "Visual Age to .NET Migration - Comprehensive Analysis & Plan" in header center, and footer containing page numbers (format: "Page X of Y"), document version (v1.0), and confidentiality notice ("CONFIDENTIAL - Internal Use Only")
- **FR-058**: Document MUST include comprehensive table of contents automatically generated with hierarchical section numbers (1, 1.1, 1.1.1), section titles, and page numbers, hyperlinked for PDF navigation, covering all sections: Executive Summary, Legacy System Analysis, Target Architecture, Function Point Analysis, Project Timeline, MIGRAI Methodology, Budget & ROI, Component Specifications, Risk Management, Appendices
- **FR-059**: Document MUST use consistent typography throughout: Heading 1 (18pt Arial Bold), Heading 2 (16pt Arial Bold), Heading 3 (14pt Arial Bold), Heading 4 (12pt Arial Bold), Body text (11pt Arial Regular with 1.15 line spacing), Code blocks (10pt Consolas monospace with light gray background), Captions (9pt Arial Italic), with proper whitespace (1 blank line after headings, 0.5 blank line between paragraphs)
- **FR-060**: Document MUST use color coding for visual organization: blue headers (#0066cc) for technical architecture sections, green highlights (#00a859) for success criteria and completed items, yellow highlights (#ffcc00) for risks and warnings requiring attention, red highlights (#e80c4d) for critical constraints and blockers, neutral gray (#666666) for reference material and appendices, maintaining sufficient contrast for readability and professional appearance
- **FR-061**: Document MUST include appendices with: Appendix A - Glossary of Technical Terms (alphabetical list defining CICS, ESQL, EZEE, BTNF, SOAP, REST, EF Core, Clean Architecture, etc.), Appendix B - Bibliography (URLs to Microsoft .NET 9 docs, React 19 docs, IFPUG FPA manual v4.3.1, Azure Architecture Center, MIGRAI methodology papers), Appendix C - Project Team Contacts (names, roles, email, phone for key stakeholders), Appendix D - Version History and Change Log (v1.0 initial release with date and author, space for future revisions)
- **FR-062**: Document MUST be generated in PDF format (PDF/A-1b standard for long-term archival) with embedded fonts for consistent rendering, document properties metadata including title ("Visual Age to .NET Migration Plan"), author ("Caixa Seguradora Migration Team"), subject ("Legacy System Modernization"), keywords ("Visual Age, .NET 9, React, MIGRAI, Function Points, Insurance Claims"), creation date (2025-10-23), and document version (1.0), ensuring searchable text and accessibility compliance

### Key Entities

- **Executive Summary Section**: Contains 2-3 page overview for C-level executives including project context (legacy IBM VisualAge EZEE system supporting insurance claim processing), business drivers for migration (mainframe cost reduction, technical debt elimination, improved developer productivity, faster feature delivery), high-level solution approach (.NET 9 backend with Clean Architecture, React 19 frontend, cloud deployment to Azure), project scope (6 user stories covering search, payment authorization, history, consortium, workflow, dashboard with 55 functional requirements), timeline summary (2 months development + 1 month homologation = 3 months total), budget overview (180-220 adjusted function points × R$ 750 per FP + infrastructure + contingency = R$ 180,000-220,000 total investment), expected ROI (annual savings R$ 95,000 from reduced mainframe costs and improved productivity with 2.1 year payback period), key risks (external service integration, currency conversion accuracy, concurrent user handling) with mitigation strategies, and go/no-go decision framework with success criteria

- **Legacy System Analysis Section**: Contains comprehensive 15+ page documentation of IBM VisualAge EZEE SIWEA system including: architecture overview (CICS transaction processing model, DB2 relational database, ESQL stored procedures for business logic, SOAP web services for external integration), detailed description of 42 business rules with ESQL code samples (payment type validation, beneficiary requirement based on insurance type, currency conversion VALPRIBT = VALPRI × VLCRUZAD, phase management workflow rules, consortium product routing logic), Entity-Relationship diagrams for 13 database tables showing primary keys (NUMSINISTRO for claims, ORGSIN+RMOSIN+NUMSIN for history), foreign key relationships (ClaimHistory → ClaimMaster, ClaimPhase → ClaimMaster), critical columns (SDOPAG reserve amount, TOTPAG payments made, VLCRUZAD conversion rate, DTMOVABE business date), and data types (decimal(15,2) for currency, date fields, varchar for text), CICS transaction flow diagrams showing map groups SIWEG/SIWEGH for search and detail screens with program calls, external integration analysis for CNOUA (consortium product validation with product codes 6814/7701/7709), SIPUA (EFP contract validation via EF_CONTR_SEG_HABIT table), SIMDA (HB contract validation for non-EFP products) including protocol details and error code mappings, current performance metrics (average claim search response time, payment authorization cycle time, database query performance, peak concurrent users 50-100 operators), and technical debt assessment (undocumented business rules requiring code archaeology, lack of automated tests creating regression risk, mainframe MIPS licensing costs, limited developer talent pool for COBOL/CICS skills)

- **Target Architecture Section**: Contains comprehensive 20+ page specification of .NET 9 + React 19 solution including: Clean Architecture pattern with three-layer structure (API layer: ASP.NET Core 9 controllers for REST endpoints + SoapCore 1.x for SOAP endpoints, Core layer: domain entities and business logic in framework-agnostic C# 12, Infrastructure layer: EF Core 9 repositories for data access + HttpClient for external services), technology stack justification table comparing options (EF Core vs Dapper vs ADO.NET for data access, SoapCore vs CoreWCF for SOAP, Recharts vs Chart.js for dashboard visualizations) with pros/cons and decision rationale, backend service designs showing interfaces and implementations (IClaimService with methods SearchByProtocolAsync/AuthorizePaymentAsync, IValidationService with ValidateConsortiumProductAsync calling CNOUA/SIPUA/SIMDA, ICurrencyConversionService with ConvertToBTNF using TGEUNIMO rates), frontend component specifications with TypeScript interfaces (ClaimSearchPage with props: onSearchComplete and state: searchCriteria/isLoading/errorMessage/results, PaymentAuthorizationForm with validation logic and SOAP API integration, MigrationDashboardPage with real-time metrics using React Query for polling), API contracts with OpenAPI 3.0 YAML specifications for all REST endpoints (POST /api/claims/search request schema with protocol/claim/leader fields, response schema with claim array, 200/400/404/500 status codes) and WSDL definitions for SOAP endpoints (AutenticacaoService with AutenticarAsync operation matching Visual Age namespace http://ls.caixaseguradora.com.br/...), database migration strategy using EF Core database-first approach with Fluent API configurations (modelBuilder.Entity<ClaimMaster>().ToTable("TMESTSIN").Property(e => e.ValorPrincipal).HasColumnName("VALPRI").HasColumnType("decimal(15,2)") for legacy mappings), and deployment architecture diagram showing Docker containers deployed to Azure App Service with Azure SQL Database, Application Insights monitoring, and Key Vault for secrets

- **Function Point Analysis Section**: Contains detailed IFPUG 4.3.1 calculation with component-by-component breakdown showing: External Inputs (EI): claim search form (4 DETs for search criteria fields + 2 FTRs for ClaimMaster and BranchMaster tables = Average complexity = 4 FP), payment authorization form (12 DETs for payment type/amounts/beneficiary/etc + 3 FTRs = High complexity = 6 FP), External Outputs (EO): claim detail report with derived pending value calculation (15 DETs output + processing logic = Average complexity = 5 FP), payment authorization confirmation with currency conversion (10 DETs + derivation = Average = 4 FP), External Inquiries (EQ): claim lookup by protocol (3 DETs input + 10 DETs output + 2 FTRs = Average = 4 FP), history retrieval (2 DETs input + 12 DETs output + 1 FTR = Low = 3 FP), Internal Logical Files (ILF): ClaimMaster (1 RET + 25 DETs = Average = 10 FP), ClaimHistory (1 RET + 20 DETs = Average = 10 FP), ClaimPhase (1 RET + 15 DETs = Low = 7 FP), MigrationStatus dashboard entity (1 RET + 12 DETs = Low = 7 FP), External Interface Files (EIF): CNOUA service interface (1 RET + 8 DETs = Low = 5 FP), SIPUA (Low = 5 FP), SIMDA (Low = 5 FP), currency rate table TGEUNIMO (1 RET + 6 DETs = Low = 5 FP), summing to Unadjusted Function Points (UFP) = estimated 150-180, then 14 General System Characteristics rated 0-5 (data communications=5 for web, distributed=4 for client/server, performance=5 for response time requirements, heavily used=4 for concurrent users, transaction rate=4, online data entry=5, end-user efficiency=4 for responsive UI, online update=5, complex processing=5 for business rules, reusability=4 for service-oriented, installation ease=3 for Docker, operational ease=4, multiple sites=2, facilitate change=5 for maintainable architecture) totaling 59 influence points, calculating VAF = 0.65 + (0.01 × 59) = 1.24, final Adjusted Function Points (AFP) = UFP × VAF = 150-180 × 1.24 = 186-223 AFP (rounded estimate 200 AFP for budgeting)

- **Project Timeline Section**: Contains detailed 3-month Gantt chart and sprint breakdown showing: Phase 0 (Week 1, 5 days): Research tasks including database provider evaluation (1 day), SOAP approach investigation (1 day), external service integration planning (1 day), authentication design (1 day), documentation in research.md (1 day), deliverable: architecture decision records, Phase 1 (Weeks 2-3, 10 days): Foundation tasks including .NET solution scaffolding with 3 projects (2 days), NuGet/npm package installation (1 day), EF Core entity configurations for 13 tables (3 days), repository pattern implementation (2 days), React app setup with routing (2 days), deliverables: compilable code, data-model.md, OpenAPI specs, Phase 2 (Weeks 4-5, 10 days): Core business logic including ClaimService implementation (2 days), PaymentService with validation (2 days), 42 business rule migration from ESQL to C# (4 days), unit test development (2 days), deliverables: passing test suite 80%+ coverage, business rules migration map, Phase 3 (Week 6, 5 days): API layer including REST controllers (2 days), SOAP services (1 day), external service clients with Polly (2 days), deliverables: functional Swagger UI, SOAP WSDL, integration tests, Phase 4 (Week 7, 5 days): Frontend including ClaimSearchPage (1.5 days), ClaimDetailPage (1.5 days), MigrationDashboardPage (1.5 days), Site.css integration (0.5 days), deliverables: functional UI, component tests, Phase 5 (Week 8, 5 days): Testing including E2E tests (2 days), parity testing (1 day), performance benchmarking (1 day), security scanning (1 day), deliverables: test reports, Phase 6 (Weeks 9-12, 20 days): Homologation including Azure deployment (2 days), UAT with operators (10 days), parallel operation (5 days), defect fixing (2 days), go-live preparation (1 day), with key milestones: M1-Research Done (end Week 1), M2-Foundation Ready (end Week 3), M3-Core Complete (end Week 5), M4-APIs Functional (end Week 6), M5-UI Complete (end Week 7), M6-Testing Passed (end Week 8), M7-UAT Approved (end Week 11), M8-Go-Live (Week 12), critical path: Research → Foundation → Core → Testing → Homologation, resource allocation: 2 backend devs full-time Weeks 1-6, 2 frontend devs full-time Weeks 4-7, 1 QA engineer full-time Weeks 5-12, 1 DevOps engineer part-time throughout, 1 technical lead oversight throughout, 1 PM coordination throughout

- **MIGRAI Methodology Section**: Contains explanation of the six-principle framework for AI-assisted legacy system modernization: Modernization (migrate to .NET 9 modern framework leveraging C# 12 language features like record types and pattern matching, React 19 with concurrent rendering for responsive UI, containerization with Docker for consistent deployment, cloud-native architecture on Azure App Service with horizontal auto-scaling, elimination of technical debt from procedural COBOL code to object-oriented C# with SOLID principles), Intelligence (integration of Claude 3.5 Sonnet LLM via Anthropic API for automated code generation from Visual Age ESQL stored procedures to C# LINQ queries achieving 95% accuracy verified through testing, AI-assisted test case generation from Given-When-Then business rule specifications, automated documentation extraction from legacy code comments using GPT-4 for markdown generation, code review automation checking Clean Architecture compliance using Claude Code analyzing dependencies, knowledge extraction from undocumented systems through pattern recognition), Gradual migration (phased rollout following user story priorities P1→P6 with each phase independently deployable, feature toggle implementation using LaunchDarkly or Azure App Configuration for controlled activation per user group, parallel operation minimum 2 weeks running both Visual Age and .NET systems side-by-side for validation, incremental data migration with fallback capability, rollback procedures at each phase gate with automated database backup/restore), Resilience (Polly retry policies with exponential backoff starting 1 second doubling to max 30 seconds with 3 retry attempts for transient HTTP failures, circuit breaker pattern opening after 5 consecutive failures and half-opening after 60 seconds cooldown, fallback mechanisms returning cached data when external services CNOUA/SIPUA/SIMDA unavailable, comprehensive exception handling with try-catch blocks at service boundaries logging to Serilog and returning user-friendly Portuguese error messages, graceful degradation disabling non-critical features like dashboard real-time updates if infrastructure unavailable, transaction rollback using EF Core TransactionScope ensuring ACID properties), Automation (GitHub Actions CI/CD pipeline with stages: build → unit test → integration test → security scan → deploy to dev → manual approval → deploy to staging → E2E test → manual approval → deploy to production, automated xUnit testing with code coverage requirement 80% enforced as quality gate, automated Playwright E2E testing running nightly against staging environment, automated OWASP dependency check scanning for security vulnerabilities, automated deployment to Azure using Terraform infrastructure-as-code, automated function point recalculation when requirements change triggering budget review, automated performance regression testing comparing response times to baseline alerting if degradation >20%), Integration (backward-compatible SOAP endpoints preserving Visual Age namespaces http://ls.caixaseguradora.com.br/LS1134WSV0001_Autenticacao/v1 for legacy client systems, new RESTful APIs following OpenAPI 3.0 specification with /api/v1 versioning for modern applications, zero database schema changes with EF Core Fluent API mapping legacy column names VALPRI to ValorPrincipal property, seamless authentication with Active Directory using LDAP protocol mapping EZEUSRID legacy identifier to modern UPN user principal name, preservation of external service contracts CNOUA/SIPUA/SIMDA maintaining exact request/response formats, backward-compatible error code mapping Visual Age error numbers to HTTP status codes with detailed messages)

- **Budget and Cost Section**: Contains comprehensive financial analysis with detailed breakdown: Development cost calculation (estimated 200 AFP × R$ 750 per function point = R$ 150,000 for all software development labor), Infrastructure costs (Azure App Service Premium P1v3 with 2 instances for HA: R$ 2,500/month × 3 months = R$ 7,500, Azure SQL Database S3 tier 100GB: R$ 1,200/month × 3 months = R$ 3,600, Azure Application Insights monitoring: R$ 500/month × 3 months = R$ 1,500, Azure Key Vault: R$ 300/month × 3 months = R$ 900, Dev/staging environments: R$ 2,000 one-time, subtotal infrastructure = R$ 15,500), Additional costs (MIGRAI methodology training for 6-person team: R$ 5,000, Visual Studio Enterprise licenses for 4 developers: R$ 3,000, Azure DevOps advanced subscription: R$ 1,000, testing tools Playwright licenses: R$ 500, subtotal additional = R$ 9,500), Contingency reserve (15% of development + infrastructure + additional = 15% × R$ 175,000 = R$ 26,250 for scope changes and unexpected issues), Total project investment (R$ 150,000 + R$ 15,500 + R$ 9,500 + R$ 26,250 = R$ 201,250), Payment milestone schedule aligned with phases (Milestone 1 at contract signature: 20% × R$ 201,250 = R$ 40,250 upfront, Milestone 2 at Phase 1 completion with foundation verified: 20% = R$ 40,250, Milestone 3 at Phase 5 completion with testing passed: 30% = R$ 60,375, Milestone 4 at UAT approval after homologation: 20% = R$ 40,250, Milestone 5 at 30 days post-go-live stability: 10% = R$ 20,125), ROI projection showing annual savings (mainframe MIPS and DB2 licensing reduction: R$ 30,000/year, developer productivity gain from modern tooling 20% efficiency: R$ 40,000/year value, reduced training costs hiring modern .NET developers vs COBOL: R$ 15,000/year, improved availability 99.9% cloud SLA vs 95% mainframe: R$ 10,000/year revenue protection, total annual savings = R$ 95,000), payback period calculation (total investment R$ 201,250 ÷ annual savings R$ 95,000 = 2.1 years breakeven), and 5-year TCO analysis (Year 0: -R$ 201,250 investment, Years 1-5: +R$ 95,000 savings each = net R$ 273,750 value over 5 years)

- **Component Specification Section**: Contains detailed technical specifications for each software component including: ClaimSearchPage React component (TypeScript interface ClaimSearchProps with onSearchComplete callback, ClaimSearchState with searchCriteria: {searchType: 'protocol'|'claim'|'leader', protocolFields, claimFields, leaderFields}, isLoading boolean, errorMessage string, results array, component lifecycle useEffect for componentDidMount initialization, event handlers handleSearchTypeChange/handleFieldChange/handleSubmit with validation checking at least one complete criterion, API integration using Axios POST to /api/claims/search with request DTO, Site.css class mappings: .search-form container, .search-field-group for fieldsets, .search-button primary button style, .error-message for validation messages in #e80c4d red, .results-table for claim list with sortable columns), PaymentAuthorizationForm component (props: claim object with protocol/number/policy/reserve/pending, onAuthorizationComplete callback, state: authorizationData with paymentType dropdown 1-5, principalAmount currency input, correctionValue optional currency, beneficiary conditional text, validationErrors object, isSubmitting boolean, validation logic checking paymentType required in range, principalAmount required numeric > 0, beneficiary required when claim.tpsegu != 0, handleSubmit calling SOAP AutenticarAsync for session then CriarSolicitacaoAsync with payment details, error handling displaying Portuguese messages from SOAP faults), ClaimService backend (interface IClaimService with methods: Task<ClaimSearchResult> SearchByProtocolAsync(string fonte, string protsini, string dac), Task<ClaimSearchResult> SearchByClaimNumberAsync(string orgsin, string rmosin, string numsin), Task<ClaimDetail> GetClaimDetailsAsync(string claimId), implementation ClaimService constructor injecting IClaimRepository and ILogger, SearchByProtocolAsync implementation querying repository with Include for BranchMaster/PolicyMaster eager loading, mapping entities to DTOs using AutoMapper, throwing ClaimNotFoundException when not found), PaymentService (interface IPaymentService with Task<PaymentAuthorizationResult> AuthorizePaymentAsync(PaymentAuthorizationRequest request, string userId), implementation with dependencies IClaimRepository, IValidationService, ICurrencyConversionService, IPhaseManagementService, ILogger, AuthorizePaymentAsync workflow: begin transaction → fetch claim → validate product type calling CNOUA/SIPUA/SIMDA → calculate currency conversion VALPRIBT = VALPRI × VLCRUZAD → create ClaimHistory record with operation code 1098 → increment claim ocorhist counter → update claim phase → commit transaction or rollback on any failure, comprehensive error handling with specific exception types), ValidationService (IValidationService with methods Task<ValidationResult> ValidateConsortiumProductAsync(string productCode, string contractNumber), Task<ValidationResult> ValidateEFPContractAsync(string contractNumber), Task<ValidationResult> ValidateHBContractAsync(string contractNumber), implementation using HttpClient factory with Polly policies: retry policy with exponential backoff WaitAndRetryAsync(3, retryAttempt => TimeSpan.FromSeconds(Math.Pow(2, retryAttempt))), circuit breaker policy with AdvancedCircuitBreakerAsync(failureThreshold: 0.5, samplingDuration: 30s, minimumThroughput: 5, durationOfBreak: 60s), timeout policy with TimeoutAsync(30s), ValidateConsortiumProductAsync calling CNOUA SOAP endpoint with product codes 6814/7701/7709, parsing response for error code EZERT8, returning ValidationResult with success boolean and error message)

- **Diagram Collection Section**: Contains high-quality visual diagrams generated using Lucidchart or Draw.io including: High-Level Architecture Diagram (6-tier layered view showing Client Tier with browser icons labeled "Desktop Chrome/Firefox/Safari" and "Mobile iOS/Android" plus "Legacy SOAP Clients", Presentation Tier with React 19 logo and "SPA with Site.css", API Tier with ASP.NET Core 9 logo split into "REST Controllers /api" and "SOAP Services /soap via SoapCore", Business Logic Tier with C# logo and "Core Services: ClaimService, PaymentService, ValidationService", Data Access Tier with EF Core logo and "Repositories + DbContext", External Services Tier with cloud icons for "CNOUA", "SIPUA", "SIMDA" showing HTTP/SOAP protocols, Database Tier with SQL Server/DB2 cylinder icon labeled "13 Legacy Tables", arrows showing request/response flow downward and data flow upward), Clean Architecture Onion Diagram (concentric circles: innermost Core circle with "Entities: Claim, ClaimHistory, Interfaces: IClaimRepository", next Application circle with "Services: ClaimService, Validators: PaymentValidator", next Infrastructure circle with "Repositories: ClaimRepository, Clients: CNOUAClient, Logging: Serilog", outermost API circle with "Controllers: ClaimsController, SOAP: AutenticacaoService, Middleware: ErrorHandler", dependency arrows pointing inward showing Core has zero dependencies, Application depends on Core abstractions, Infrastructure implements Core interfaces, API depends on Application and Infrastructure through DI), Entity-Relationship Diagram (UML notation showing 13 entities as boxes with three sections: table name in header, attributes listed with types, primary key underlined, foreign keys with asterisk, relationship lines connecting entities: ClaimMaster ──1:N── ClaimHistory, ClaimMaster ──1:N── ClaimPhase, ClaimMaster ──N:1── BranchMaster, ClaimMaster ──N:1── PolicyMaster, ClaimHistory ──N:1── CurrencyUnit, ClaimPhase ──N:1── PhaseEventRelationship, cardinality shown with crow's foot notation, critical columns highlighted: NUMSINISTRO, VALPRI/VALPRIBT, DTMOVABE, VLCRUZAD), React Component Hierarchy (tree diagram: App.tsx root with Router, branching to routes: "/" → ClaimSearchPage → ClaimSearchForm + ClaimResultsTable, "/claims/:id" → ClaimDetailPage → ClaimSummary + PaymentAuthorizationForm + HistoryTable, "/dashboard" → MigrationDashboardPage → DashboardOverview + UserStoryGrid + ComponentGrid + PerformanceChart + ActivitiesTimeline, shared components at bottom: Button, Input, Modal, ErrorMessage, LoadingSpinner, import dependencies shown with dotted arrows), Payment Authorization Sequence Diagram (UML sequence showing time flowing downward, 10 participants as vertical lifelines from left to right: Operator actor, PaymentAuthorizationForm component, ClaimsController, ClaimService, ValidationService, CNOUA Service (external), PaymentService, ClaimRepository, EF DbContext, Database, interactions: 1. Operator → Form: submits payment data, 2. Form → Controller: POST /api/payments/authorize, 3. Controller → ClaimService: AuthorizePaymentAsync, 4. ClaimService → ValidationService: ValidateConsortiumProductAsync, 5. ValidationService → CNOUA: HTTP POST with retry loop 3x if 5xx error, 6. CNOUA returns validation result, 7. ClaimService → PaymentService: CreatePaymentAsync, 8. PaymentService → Repository: BeginTransaction, 9-12. Repository performs Create history + Update claim + Update phase via DbContext to Database, 13. Repository → PaymentService: CommitTransaction, 14-17. Response flows back up to Operator, alt fragment showing error path: if validation fails → RollbackTransaction → return error to UI), Gantt Chart (Microsoft Project style chart with horizontal timeline across top showing weeks 1-12, vertical swimlanes for 6 phases, tasks within phases as colored bars: Phase 0 Week 1 with 5 research tasks shown as adjacent bars, Phase 1 Weeks 2-3 with foundation tasks some overlapping, Phase 2 Weeks 4-5 with core implementation tasks, Phase 3 Week 6 API tasks, Phase 4 Week 7 frontend tasks, Phase 5 Week 8 testing tasks in sequence, Phase 6 Weeks 9-12 with UAT/deployment tasks, dependencies shown as arrows between bars: foundation → core → API → testing, milestones shown as yellow diamonds: M1 end Week 1, M2 end Week 3, M3 end Week 5, M4 end Week 6, M5 end Week 7, M6 end Week 8, M7 end Week 11, M8 Week 12, critical path highlighted in red: Research → Foundation → Core → Testing → UAT → Go-Live, resource swimlanes at bottom showing team member icons: 2 backend devs assigned Weeks 1-6, 2 frontend devs Weeks 4-7, 1 QA Weeks 5-12, 1 DevOps throughout, 1 tech lead oversight, 1 PM coordination), External Service Integration Diagram (component diagram showing Backend Services box containing ClaimService and ValidationService, arrows pointing to Polly Policy Wrapper box containing "Retry Policy (exponential backoff 1-30s, 3 retries)", "Circuit Breaker (open after 5 failures, 60s half-open)", "Timeout Policy (30s)", arrows from Polly to three external service boxes: CNOUA (product validation for 6814/7701/7709), SIPUA (EFP contract validation), SIMDA (HB contract validation), each service box showing HTTP/SOAP protocol and typical response times, error handling flow shown with red dotted arrows back to Fallback Strategy box containing "Cache last successful response", "Return default validation", "Log error to Application Insights"), Deployment Architecture Diagram (Azure cloud boundary containing: Virtual Network box, within it App Service Plan box containing two App Service instances "Backend Instance 1" and "Backend Instance 2" for HA with load balancer icon, Azure SQL Database box showing "13 Legacy Tables + 3 Dashboard Tables", Azure Key Vault box with secrets icon, Application Insights box with monitoring icon, arrows showing: Internet → Azure Front Door → Load Balancer → App Service instances, App Services → SQL Database bidirectional, App Services → Key Vault for secrets retrieval, All services → Application Insights for telemetry, External Services (CNOUA/SIPUA/SIMDA) → Virtual Network through firewall, security annotations: NSG rules, TLS 1.2+ encryption, managed identities for auth)

## Success Criteria

### Measurable Outcomes

- **SC-001**: Document contains minimum 50 pages of comprehensive content covering all required sections (executive summary, legacy analysis, target architecture, function points, timeline, MIGRAI methodology, budget, component specifications) with professional formatting and visual elements
- **SC-002**: Legacy system analysis section provides complete understanding of Visual Age SIWEA system enabling any .NET developer unfamiliar with COBOL/CICS to comprehend the system architecture, 42 business rules, 13-table data model, and 3 external integration points without accessing the original source code
- **SC-003**: Target architecture section provides sufficient technical detail (interface definitions, class structures, API contracts, database configurations) that development team can begin implementation immediately after document approval without requiring additional architecture decisions or clarification meetings
- **SC-004**: Function point analysis yields a total between 180-220 Adjusted Function Points with detailed breakdown showing calculation methodology (EI/EO/EQ/ILF/EIF classification, complexity ratings, UFP calculation, 14 GSC ratings, VAF formula) that can be validated by independent FPA auditors certified in IFPUG 4.3.1
- **SC-005**: Budget calculation based on function points results in total project cost between R$ 180,000 and R$ 220,000 with transparent breakdown of development costs (AFP × R$ 750), infrastructure costs (Azure services), additional costs (training, licensing), and contingency reserves (15%)
- **SC-006**: Timeline demonstrates realistic 3-month schedule (8 weeks development across 6 phases + 4 weeks homologation with UAT) with achievable weekly milestones (no single task exceeding 5 days duration) and appropriate resource allocation (6-8 team members with no single person over 100% allocation)
- **SC-007**: MIGRAI methodology description enables development team to understand and apply the framework principles throughout migration execution, particularly the Intelligence principle with LLM integration for code generation achieving 95%+ accuracy and Automation principle with CI/CD quality gates
- **SC-008**: Component specifications provide sufficient detail (TypeScript interfaces with property types, C# method signatures with parameters and return types, validation rules, error handling patterns) that frontend developers can implement React components and backend developers can implement services without requiring clarification questions for 90% of implementation decisions
- **SC-009**: All diagrams are professional quality with clear labeling (all boxes/arrows/icons labeled with technology names or component names), appropriate detail level (High-Level Architecture shows tiers not individual classes, Sequence Diagram shows key interactions not every method call), and consistent notation (UML for architecture/sequence diagrams, BPMN for process flows, ER notation for database, Gantt for timeline)
- **SC-010**: Document is formatted professionally with consistent branding (Caixa Seguradora logo on every page in header, corporate color scheme maintained throughout), proper typography (heading hierarchy 18pt/16pt/14pt/12pt, body text 11pt with 1.15 line spacing, monospace code blocks), color-coded sections for navigation (blue for technical, green for success criteria, yellow for warnings, red for constraints), comprehensive table of contents with section numbering and page numbers, and navigable structure via hyperlinks in PDF
- **SC-011**: Executive summary enables C-level executives to make informed go/no-go decision within 15 minutes of reading by clearly presenting business justification (mainframe cost reduction, technical debt elimination), cost-benefit analysis (R$ 201,250 investment vs R$ 95,000 annual savings = 2.1 year payback), risk assessment (high/medium/low risks with mitigation strategies), and expected outcomes (modern maintainable system, improved developer productivity, faster feature delivery)
- **SC-012**: Risk assessment section identifies minimum 15 high/medium/low risks with specific mitigation strategies enabling project team to proactively address potential blockers: high risks include external service unavailability (mitigation: circuit breakers + fallback mechanisms), currency conversion accuracy (mitigation: comprehensive test suite with parity testing), concurrent user data conflicts (mitigation: EF Core concurrency tokens + retry logic), medium risks include performance under load (mitigation: early benchmarking + query optimization), SOAP compatibility issues (mitigation: contract testing with legacy clients), low risks include Site.css responsive design (mitigation: early UI prototyping + cross-browser testing)
- **SC-013**: Payment milestone schedule aligns with project phases ensuring cash flow management and incentivizing timely delivery (20% upfront prevents contractor risk, 30% at testing completion rewards major deliverable, 10% retention at 30 days post-go-live ensures production stability) with payments tied to verifiable completions (foundation compilable code, testing passed with reports, UAT signed acceptance)
- **SC-014**: Document can be generated and updated programmatically as project progresses, with templates for each section allowing automated content updates (function point recalculation when requirements change triggering budget review, Gantt chart regeneration when timeline shifts, diagram updates when architecture evolves), version control in Git repository, and CI/CD pipeline generating PDF output
- **SC-015**: PDF output meets accessibility and archival standards (PDF/A-1b format for long-term preservation, embedded fonts for consistent rendering across systems, searchable text layer enabling keyword search, proper heading structure with semantic tags for screen readers, alt text descriptions for all diagrams, sufficient color contrast ratios 4.5:1 minimum for WCAG AA compliance) enabling regulatory compliance and future reference

## Assumptions

- The existing Visual Age SIWEA source code (#SIWEA-V116.esf) is fully accessible and can be analyzed to extract all 42 business rules, ESQL stored procedures, CICS map definitions, and integration logic without requiring mainframe access or specialized tools beyond a text editor
- All 13 database tables (TMESTSIN, THISTSIN, TGERAMO, TGEUNIMO, TSISTEMA, TAPOLICE, SI_ACOMPANHA_SINI, SI_SINISTRO_FASE, SI_REL_FASE_EVENTO, EF_CONTR_SEG_HABIT) are documented with complete column definitions, data types, primary/foreign keys, and relationships, or can be reverse-engineered using database schema inspection tools (SQL Server Management Studio, DB2 Control Center)
- External validation services (CNOUA consortium validation, SIPUA EFP contract validation, SIMDA HB contract validation) have documented APIs with SOAP/REST contracts or existing integration code in Visual Age system provides sufficient protocol details to recreate integrations
- The Site.css stylesheet from POC project (/Users/brunosouza/Development/Caixa Seguradora/POC Visual Age/Site.css) represents complete visual design requirements including all necessary CSS classes for forms, tables, buttons, error messages, responsive breakpoints, and will be used without modifications
- Function point estimation uses IFPUG 4.3.1 methodology which is the internationally recognized standard accepted by the organization for sizing software projects, and the counting will be performed by or validated by a certified FPA practitioner
- The R$ 750 per function point rate represents a fixed-price contract based on function point delivery, not hourly billing (note: user said "por hora" but context indicates per-function-point pricing), with payment milestones tied to deliverable completion rather than time spent
- A development team of 6-8 professionals is available for the full 3-month project duration with skills: 2 senior .NET developers (C#, ASP.NET Core, EF Core experience), 2 senior frontend developers (React, TypeScript, CSS experience), 1 QA engineer (testing automation with xUnit, Playwright), 1 DevOps engineer (Azure, Docker, CI/CD pipelines), 1 technical lead (architecture oversight, code review), 1 project manager (coordination, stakeholder communication)
- The MIGRAI methodology is a proprietary framework developed by the consultancy for legacy system modernization incorporating six principles (Modernization, Intelligence, Gradual migration, Resilience, Automation, Integration) with specific emphasis on LLM-assisted development using Claude Code and automated quality gates
- Claude Code (Claude 3.5 Sonnet model via Anthropic API) is available for AI-assisted development throughout the project with API access credentials, usage within rate limits (100,000 tokens per minute), and budget allocated for API costs estimated at R$ 2,000-3,000 for the project duration
- The homologation period (1 month spanning Weeks 9-12) includes comprehensive user acceptance testing with 10-15 insurance operators representing typical users, parallel operation with Visual Age system for validation (both systems processing same transactions for comparison), production-like Azure environment replicating prod configuration, and go-live readiness assessment using defined checklist
- Azure cloud infrastructure is the target deployment platform with organizational approval for cloud adoption, appropriate budget allocated for 3-month duration (App Service Premium P1v3, SQL Database S3 tier, Key Vault, Application Insights), and enterprise agreement pricing available for cost optimization
- The existing database schema will not be modified during migration requiring all EF Core entity configurations to map to legacy table/column names using Fluent API, no new indexes added (unless read-only), no schema refactoring, preserving exact data types especially decimal(15,2) for currency fields
- Performance requirements match or exceed existing Visual Age system metrics: claim search response time < 3 seconds (current baseline unknown but assumed 5-8 seconds), payment authorization cycle < 90 seconds end-to-end (from form display to confirmation), system available for 99.9% uptime (improved from current mainframe 95% assumed), support 50-100 concurrent operators during business hours with peaks up to 150
- The Caixa Seguradora logo provided as base64 PNG data (in existing spec.md from 001-visualage-dotnet-migration) is the current approved brand asset for use in all applications and documentation, no alternative logo needed, dimensions and resolution appropriate for both print and digital display
- All project documentation including this comprehensive PDF will be stored in Git repository under specs/001-visual-age-migration-pdf/ directory, versioned with semantic versioning (v1.0, v1.1, etc.), and generated using automated tooling (LaTeX or Markdown-to-PDF) from source templates enabling programmatic updates

## Dependencies

- Access to Visual Age SIWEA source code (#SIWEA-V116.esf file) and any accompanying documentation (design docs, business rule specifications, data dictionaries) for comprehensive legacy system analysis extracting 42 business rules, ESQL code, CICS transaction flows, and integration patterns
- Access to existing database schema (DB2 or SQL Server) with permissions to query system catalog tables for reverse engineering entity models, column definitions, relationships, constraints, and indexes using tools like SQL Server Management Studio or IBM Data Studio
- Availability of Site.css stylesheet from POC project located at /Users/brunosouza/Development/Caixa Seguradora/POC Visual Age/Site.css for integration into React frontend ensuring visual consistency with legacy system appearance
- Availability of existing migration artifacts from 001-visualage-dotnet-migration spec including: spec.md with 55 functional requirements and 6 user stories, plan.md with Phase 0-6 breakdown, research.md with architecture decisions (EF Core, SoapCore, Polly, Recharts selections), data-model.md with entity definitions, for reuse and reference in this comprehensive document
- Stakeholder availability for requirements validation, function point analysis review (2-4 hours for FPA walkthrough), budget approval meetings (1-2 hours for executive review), and timeline alignment discussions (1 hour for milestone confirmation) during document creation and review cycle
- Technical lead availability for architecture decisions validation, MIGRAI methodology guidance and team training (4-8 hours), technology stack review and approval, and risk assessment input based on similar migration projects
- Development environment provisioning for document generation including: LaTeX distribution (TeX Live or MiKTeX) for PDF generation from .tex source files, or Microsoft Word with PDF export capability, diagram creation tools (Lucidchart with team license, or Draw.io/Diagrams.net for open-source option, or Microsoft Visio), Gantt chart creation tool (Microsoft Project, or GanttProject open-source alternative), and version control in Git repository
- Claude Code API access for LLM-assisted document generation including: Anthropic API key with appropriate usage tier (Claude 3.5 Sonnet model), budget allocation for API costs estimated R$ 500-1,000 for document generation and updates, prompts engineered for extracting business rules from ESQL code, generating component specifications from requirements, and creating technical descriptions
- Project management tooling for timeline creation including: Microsoft Project license for Gantt chart generation with critical path analysis, resource allocation views, and milestone tracking, or open-source alternative like GanttProject or ProjectLibre, integration with task tracking system (Azure DevOps, Jira, or GitHub Projects) for real-time progress updates
- Diagram creation tooling with templates for architecture diagrams (layered architecture, onion architecture, component diagrams following UML 2.5 notation), sequence diagrams (UML sequence notation with lifelines and interactions), ER diagrams (crow's foot notation with entities, attributes, relationships), and deployment diagrams (Azure architecture symbols from Microsoft)
- Function point analysis expertise either: certified FPA practitioner in IFPUG methodology (CFPS certification preferred) available for 8-16 hours to perform detailed counting and validation, or training for project team member in IFPUG 4.3.1 counting rules (40-hour course), or third-party consulting firm for independent FPA audit
- Access to historical performance data from Visual Age system for baseline metrics including: average response times for search/authorization operations collected from CICS transaction logs or APM tooling, peak concurrent users from CICS region statistics or user login logs, transaction volumes (transactions per second) from database query logs, system availability percentages from mainframe monitoring tools, if data unavailable then assumptions clearly documented
- Budget approval authority with timeframe for decision-making since document cost estimate R$ 180,000-220,000 likely requires executive approval, understanding of payment terms (milestone-based vs time-and-materials), and procurement process for engaging development team and cloud infrastructure
- Risk acceptance from stakeholders for identified high/medium risks including: external service integration dependencies (CNOUA/SIPUA/SIMDA may be unavailable during development), performance under load may not meet targets on first attempt requiring tuning, concurrent user scenarios may reveal data consistency issues requiring architecture refinement, homologation period may uncover additional requirements extending timeline

## Out of Scope

- Actual implementation of the .NET 9 + React migration software (this specification creates comprehensive planning document only, not executable code, source files, or deployed application)
- Modification of Visual Age legacy system or any changes to existing mainframe infrastructure (CICS configuration, ESQL stored procedures, DB2 database schema) during analysis or parallel operation period
- Training delivery for insurance operators on the new .NET system (training materials may be outlined but instructor-led sessions, hands-on workshops, and certification programs are separate engagement)
- Ongoing maintenance and support costs beyond the 3-month project timeline (post-go-live support including bug fixes, performance tuning, feature enhancements, and infrastructure management requires separate MSA)
- Integration with systems beyond the three external validation services explicitly mentioned (CNOUA consortium validation, SIPUA EFP contract validation, SIMDA HB contract validation) - any additional integrations discovered require scope change
- Data migration scripts or ETL processes for historical claim records (assumption is existing data remains in place and accessed via EF Core, bulk migration or archival is separate project)
- Disaster recovery and business continuity planning for the new .NET system (Azure Site Recovery configuration, backup/restore procedures, failover testing, RTO/RPO requirements analysis separate)
- Regulatory compliance validation beyond general security best practices (specific SUSEP insurance regulations, LGPD personal data protection requirements, PCI-DSS for payment data if applicable, SOC 2 audit preparation out of scope)
- Performance testing beyond specified success criteria (formal load testing with thousands of concurrent users, stress testing to determine breaking point, endurance testing for memory leaks over 72+ hours out of scope)
- Alternative architecture options or technology stack comparisons (document assumes .NET 9 + React stack already decided, no evaluation of Java Spring Boot vs .NET, Angular vs React, PostgreSQL vs SQL Server)
- Detailed user interface mockups or interactive prototypes beyond component specifications (Figma high-fidelity designs, clickable InVision prototypes, user testing sessions, heuristic evaluations out of scope)
- Source code for the migrated application (this document describes what to build with architecture diagrams and component specs, but actual C# files, .tsx files, SQL scripts are implementation phase)
- Deployment automation scripts beyond conceptual description (detailed Terraform .tf files for infrastructure-as-code, Docker Compose configurations, Kubernetes manifests, GitHub Actions workflow YAML files out of scope for planning document)
- Third-party vendor evaluation or procurement for supporting tools beyond those already specified (no RFP process for APM monitoring tools, no POC evaluation of Polly vs alternative resilience frameworks)
- Change management process and organizational readiness assessment for adoption of new system (stakeholder analysis, communication plan, resistance management, training needs analysis separate organizational change project)
- Database performance tuning or query optimization beyond EF Core best practices (specific index creation strategies, query execution plan analysis, database statistics maintenance, partitioning strategies out of scope)
- Security architecture design beyond authentication mechanism (network segmentation, firewall rules, WAF configuration, DDoS protection, penetration testing, security code review separate security engagement)
- Accessibility compliance beyond PDF/A format requirements (WCAG 2.1 AA compliance for web UI, screen reader testing, keyboard navigation verification, color contrast analysis separate accessibility audit)

## References

- Visual Age SIWEA Source: `/Users/brunosouza/Development/Caixa Seguradora/POC Visual Age/#SIWEA-V116.esf` (IBM VisualAge EZEE 4.40, last revision CAD73898 February 11, 2014)
- Site.css Stylesheet: `/Users/brunosouza/Development/Caixa Seguradora/POC Visual Age/Site.css` (960px max-width content wrapper, responsive breakpoints, error styling #e80c4d)
- Existing Migration Specification: `/Users/brunosouza/Development/Caixa Seguradora/POC Visual Age/specs/001-visualage-dotnet-migration/spec.md` (6 user stories, 55 functional requirements, 13 entities, 19 success criteria)
- Existing Migration Plan: `/Users/brunosouza/Development/Caixa Seguradora/POC Visual Age/specs/001-visualage-dotnet-migration/plan.md` (Phase 0-6 breakdown, research areas, deliverables)
- Existing Research Decisions: `/Users/brunosouza/Development/Caixa Seguradora/POC Visual Age/specs/001-visualage-dotnet-migration/research.md` (EF Core 9 database-first approach, SoapCore 1.x for SOAP endpoints, Polly for resilience, Recharts for dashboard)
- IFPUG Function Point Counting Practices Manual Release 4.3.1: International Function Point Users Group, http://www.ifpug.org/ (EI/EO/EQ/ILF/EIF definitions, complexity matrices, VAF calculation)
- MIGRAI Methodology Framework: Proprietary framework for LLM-assisted legacy system modernization (six principles: Modernization, Intelligence, Gradual migration, Resilience, Automation, Integration)
- Microsoft .NET 9 Documentation: https://learn.microsoft.com/en-us/dotnet/ (C# 12 language features, ASP.NET Core 9 web framework, performance improvements)
- React 19 Documentation: https://react.dev/ (concurrent rendering, Server Components, use hook, TypeScript support improvements)
- Clean Architecture by Robert C. Martin: https://blog.cleancoder.com/uncle-bob/2012/08/13/the-clean-architecture.html (dependency inversion, onion architecture pattern, framework-agnostic core)
- Entity Framework Core 9 Documentation: https://learn.microsoft.com/en-us/ef/core/ (database-first approach with scaffold-dbcontext, Fluent API configurations, compiled queries)
- SoapCore GitHub Repository: https://github.com/DigDes/SoapCore (ASP.NET Core SOAP endpoints, ServiceContract attributes, WSDL generation)
- Polly Resilience Framework: https://github.com/App-vNext/Polly (retry policies, circuit breakers, timeout policies, policy wrap combinations)
- Azure Architecture Center: https://learn.microsoft.com/en-us/azure/architecture/ (cloud design patterns, reference architectures for web applications, best practices)
- Azure Well-Architected Framework: https://learn.microsoft.com/en-us/azure/well-architected/ (five pillars: reliability, security, cost optimization, operational excellence, performance efficiency)
- Caixa Seguradora Brand Guidelines: Internal document (logo usage, color palette, typography standards) - not publicly accessible
